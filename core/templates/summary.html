{% extends "layouts/base.html" %}

{% block title %} Summary {% endblock %}

<!-- Specific Plugin CSS goes HERE -->
{% block plugin_stylesheets %}{% endblock plugin_stylesheets %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<form action="/summary/" method="POST">
  {% csrf_token %}
  <div class="content-wrapper">
    <div class="row">
      <div class="col grid-margin">
        <input type="submit" value="Get Order History" name='get_order_history'>
      </div>
      <div class="col grid-margin">
        <input type="submit" value="Get Profile Data" name='get_profile_data'>
      </div>
      <div class="col grid-margin">
        <input type="submit" value="Calculate Today's PL" name='calculate_today_pl'>
      </div>
    </div>
    <div class="row">
      <div class="col grid-margin">
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-9">
                <div class="d-flex align-items-center align-self-start">
                  <div class="col-sm-9">
                    <h4 class="mb-0">$ {{options_equity | floatformat:2}}</h4>
                  </div>
                  <div class="col-sm-9">
                    <div class="row">
                      {% if options_unrealized_p_l_total < 0 %}
                        <p class="text-danger ml-2 mb-0 font-weight-medium">$ {{options_unrealized_p_l_total | floatformat:2}}</p>
                      {% else %}
                        <p class="text-success ml-2 mb-0 font-weight-medium">$ {{options_unrealized_p_l_total | floatformat:2}}</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <h6 class="text-muted font-weight-normal">Options</h6>
          </div>
        </div>
      </div>
      <div class="col grid-margin">
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-9">
                <div class="d-flex align-items-center align-self-start">
                  <div class="col-sm-9">
                    <h4 class="mb-0">$ {{stocks_equity | floatformat:2}}</h4>
                  </div>
                  <div class="col-sm-9">
                    <div class="row">
                      {% if stocks_unrealized_p_l_total < 0 %}
                        <p class="text-danger ml-2 mb-0 font-weight-medium">$ {{stocks_unrealized_p_l_total | floatformat:2}}</p>
                      {% else %}
                        <p class="text-success ml-2 mb-0 font-weight-medium">$ {{stocks_unrealized_p_l_total | floatformat:2}}</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <h6 class="text-muted font-weight-normal">Stocks</h6>
          </div>
        </div>
      </div>
      <div class="col grid-margin">
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-9">
                <div class="d-flex align-items-center align-self-start">
                  <div class="col-sm-9">
                    <h4 class="mb-0">$ {{crypto_equity | floatformat:2}}</h4>
                  </div>
                  <div class="col-sm-9">
                    <div class="row">
                      {% if crypto_unrealized_p_l_total < 0 %}
                        <p class="text-danger ml-2 mb-0 font-weight-medium">$ {{crypto_unrealized_p_l_total | floatformat:2}}</p>
                      {% else %}
                        <p class="text-success ml-2 mb-0 font-weight-medium">$ {{crypto_unrealized_p_l_total | floatformat:2}}</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <h6 class="text-muted font-weight-normal">Crypto</h6>
          </div>
        </div>
      </div>
      <div class="col grid-margin">
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-9">
                <div class="d-flex align-items-center align-self-start">
                  <h4 class="mb-0">$ {{margin_or_cash | floatformat:2}}</h4>
                </div>
              </div>
            </div>
            <h6 class="text-muted font-weight-normal">Margin used/Cash</h6>
          </div>
        </div>
      </div>
      <div class="col grid-margin">
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-9">
                <div class="d-flex align-items-center align-self-start">
                  <h4 class="mb-0">$ {{portfolio_value | floatformat:2}}</h4>
                </div>
              </div>
            </div>
            <h6 class="text-muted font-weight-normal">Portfolio Value</h6>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-6 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Pie chart</h4>
            <canvas id="pie-chart" style="height:250px"></canvas>
          </div>
        </div>
      </div>
      <div class="col-lg-6 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Bar chart</h4>
            <canvas id="barChart" style="height:250px"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

{% endblock content %}

{% block plugin_javascripts %}

<script src="/static/assets/vendors/chart.js/Chart.min.js"></script>

{% endblock plugin_javascripts %}

{% block javascripts %}

<script>
  var config =
  {
    type: 'pie',
    data:
    {
      datasets: [{
                  data: {{ data_1 | safe }},
                  backgroundColor: ['#111166', '#F9A909', '#F11080'],
                  label: 'Population'
                }],
      labels: {{ labels_1 | safe }}
    },
    options: { responsive: true }
  };

  var data =
  {
    labels: {{ labels_2 | safe }},
    datasets:
    [{
      label: 'total population',
      data: {{ data_2 | safe }},
      backgroundColor:
      [
        'rgba(255, 99, 132, 0.2)',
        'rgba(54, 162, 235, 0.2)',
        'rgba(255, 206, 86, 0.2)',
        'rgba(75, 192, 192, 0.2)',
        'rgba(153, 102, 255, 0.2)',
        'rgba(255, 159, 64, 0.2)'
      ],
      borderColor:
      [
        'rgba(255,99,132,1)',
        'rgba(54, 162, 235, 1)',
        'rgba(255, 206, 86, 1)',
        'rgba(75, 192, 192, 1)',
        'rgba(153, 102, 255, 1)',
        'rgba(255, 159, 64, 1)'
      ],
      borderWidth: 1,
      fill: false
    }]
  };

  var options =
  {
    scales:
    {
      yAxes: [{ ticks: { beginAtZero: true }, gridLines: { color: "rgba(204, 204, 204,0.1)" } }],
      xAxes: [{ gridLines: { color: "rgba(204, 204, 204,0.1)" } }]
    },
    legend: { display: false },
    elements: { point: { radius: 0 } }
  };

  window.onload = function ()
  {
    var ctx = document.getElementById('pie-chart').getContext('2d');
    var PieChart = new Chart(ctx, config);

    var ctx = document.getElementById('barChart').getContext('2d');
    var barChart = new Chart(ctx, { type: 'bar', data: data, options: options });
  };

</script>

{% endblock javascripts %}