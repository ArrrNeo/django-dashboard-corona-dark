{% extends "layouts/base.html" %}
{% load static %}
{% block title %} Summary {% endblock %}
<!-- Specific Plugin CSS goes HERE -->
{% block plugin_stylesheets %}{% endblock plugin_stylesheets %}
<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}
{% block content %}

<form action="/options_chart/" method="POST">
  <label for="ticker">ticker: </label>
  <input id="ticker" type="text" name="ticker" value="{{ ticker }}">
  <label for="date">date: </label>
  <input id="date" type="date" name="date" value="{{ date }}">
  <label for="num_strikes">num_strikes: </label>
  <input id="num_strikes" type="text" name="num_strikes" value="{{ num_strikes }}">
  <input type="submit" value="submit" name='submit'>
  {% csrf_token %}
  <!-- {{ form }} -->
  <div class="content-wrapper">
    <h4">ticker: {{ticker}}</h4>
    <br/>
    <h4">Exp: {{date}}</h4>
    <br/>
    <h4">Number for Strikes: {{num_strikes}}</h4>
    <br/>
    <h4">Current Price: $ {{curr_price}}</h4>
    <div class="row stretch-card">
      <div class="card">
        <div class="card-body">
          <div id="chartContainer1" style="height: 500px; width: 100%;"></div>
        </div>
      </div>
    </div>
    <div class="row stretch-card">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">Line chart</h4>
          <div id="chartContainer2" style="height: 500px; width: 100%;"></div>
        </div>
      </div>
    </div>
  </div>
</form>

{% endblock content %}
{% block plugin_javascripts %}
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
{% endblock plugin_javascripts %}
{% block javascripts %}
<script>
  var line_data =
  [{
    type: "line",
    indexLabelFontSize: 16,
    dataPoints: []
  },
  {
    type: "line",
    indexLabelFontSize: 16,
    dataPoints: []
  }];

  var scatter_data =
  [{
    type: "scatter",
    toolTipContent: "premium: $ {a}<br/>short_strike: $ {b}<br/>max_profit: $ {c}",
    dataPoints: []
  },
  {
    type: "line",
    indexLabelFontSize: 16,
    dataPoints: []
  }];

  window.onload = function () {
    var xx = {{x | safe}};
    var yy = {{y | safe}};
    var curr_price = {{curr_price | safe}};
    var x_axis_label = "{{x_axis_chart_1}}";
    var y_axis_label = "{{y_axis_chart_1}}";
    var chart1 = new CanvasJS.Chart("chartContainer1", { animationEnabled: false, theme : "light2", axisX: [{title: x_axis_label}], axisY: [{title: y_axis_label}], title : {text: "Premium vs Strike Price"}, data : line_data });
    var index;
    var min = yy[0];
    var max = yy[0];
    for (index = 0; index < xx.length; ++index) {
      chart1.options.data[0].dataPoints.push(    { x: xx[index], y: yy[index]}    );
      if (yy[index] < min) {
        min = yy[index];
      }
      if (yy[index] > max) {
        max = yy[index];
      }
    }
    chart1.options.data[1].dataPoints.push({ x: curr_price, y: min});
    chart1.options.data[1].dataPoints.push({ x: curr_price, y: max});
    chart1.render();

    var premium = {{premium | safe}};
    var max_profit = {{max_profit | safe}};
    var max_profit_pc = {{max_profit_pc | safe}};
    var long_strike = {{long_strike | safe}};
    var short_strike = {{short_strike | safe}};
    var x_axis_label = "{{x_axis_chart_2}}";
    var y_axis_label = "{{y_axis_chart_2}}";
    var chart2 = new CanvasJS.Chart("chartContainer2", { animationEnabled: false, theme : "light2", axisX: [{title: x_axis_label}], axisY: [{title: y_axis_label}], title : {text: "Debit Spread vs Max Profit %"}, data : scatter_data });
    var index;
    var min = max_profit_pc[0];
    var max = max_profit_pc[0];
    for (index = 0; index < premium.length; ++index) {
      chart2.options.data[0].dataPoints.push({ x: long_strike[index], y: max_profit_pc[index], a: premium[index], b: short_strike[index], c: max_profit[index] });
      if (max_profit_pc[index] < min) {
        min = max_profit_pc[index];
      }
      if (max_profit_pc[index] > max) {
        max = max_profit_pc[index];
      }
    }
    chart2.options.data[1].dataPoints.push({ x: curr_price, y: min});
    chart2.options.data[1].dataPoints.push({ x: curr_price, y: max});
    chart2.render();
  }
</script>
{% endblock javascripts %}
